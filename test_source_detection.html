<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Source Detection Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 4px solid #ddd;
        }
        .test-item.reddit { border-left-color: #ff4500; background: #fff5f0; }
        .test-item.rss { border-left-color: #ff6600; background: #fff8f0; }
        .test-item.twitter { border-left-color: #1da1f2; background: #f0f8ff; }
        .test-item.youtube { border-left-color: #ff0000; background: #fff0f0; }
        .test-item.blog { border-left-color: #8b5cf6; background: #f8f5ff; }
        .test-item.error { border-left-color: #dc2626; background: #fef2f2; }

        .icon {
            font-size: 24px;
            margin-right: 12px;
        }
        .url {
            flex: 1;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #333;
        }
        .type {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 12px;
        }
        .type.reddit { background: #ff4500; color: white; }
        .type.rss { background: #ff6600; color: white; }
        .type.twitter { background: #1da1f2; color: white; }
        .type.youtube { background: #ff0000; color: white; }
        .type.blog { background: #8b5cf6; color: white; }
        .type.error { background: #dc2626; color: white; }

        .description {
            font-size: 11px;
            color: #666;
            margin-left: 12px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value {
            font-size: 32px;
            font-weight: bold;
        }
        .stat-label {
            font-size: 12px;
            opacity: 0.9;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>🧪 Source Detection Logic Test</h1>

    <div class="stats" id="stats"></div>

    <div class="test-section">
        <h2>Test Results</h2>
        <div id="results"></div>
    </div>

    <script>
        // Your test URLs
        const testUrls = `r/ChatGPT
r/technology
r/OpenAI
r/artificial
r/ClaudeAI
r/Anthropic
r/SillyTavernAI
r/singularity
r/LocalLLM
r/WritingWithAI
r/MyBoyfriendIsAI

https://www.youtube.com/@TwoMinutePapers
https://www.youtube.com/@YannicKilcher
https://www.youtube.com/c/deeplearningai
https://www.youtube.com/@krishnaik06
https://www.youtube.com/c/GoogleCloudTech
https://www.youtube.com/@aiexplained-official
https://www.youtube.com/c/machinelearningstreettalk

@AndrewYNg
@ylecun
@drfeifei
@sama
@geoffreyhinton
@OpenAI
@StanfordHAI
@KirkDBorne
@gdb
@demishassabis

https://openai.com/blog/rss/
https://deepmind.com/blog/feed/basic
https://aws.amazon.com/blogs/ai/feed
https://www.nvidia.com/en-us/about-nvidia/rss/
https://www.artificial-intelligence.blog/rss-feeds
https://www.technologyreview.com/feed/
https://openai.com/news/rss/

https://openai.com/blog/
https://openai.com/news/
https://blog.google/technology/ai/
https://deepmind.google/discover/blog/
https://huggingface.co/blog
https://blogs.nvidia.com/
https://www.microsoft.com/en-us/ai/blog/
https://ai.meta.com/blog/
https://allenai.org/blog
https://azure.microsoft.com/en-us/blog/product/azure-openai/
https://www.uipath.com/blog/ai
https://github.blog/ai-and-ml/
https://www.artificial-intelligence.blog/
https://interconnected.blog/tag/ai/
https://rkg.blog/ai-or-die.php`;

        // Implement the FIXED detection logic
        function cleanRssUrl(url) {
            try {
                const urlObj = new URL(url);
                let domain = urlObj.hostname.replace(/^www\./, '');
                const path = urlObj.pathname;

                if (path.includes('/blog')) {
                    domain = `${domain}/blog`;
                } else if (path.length > 1 && !path.includes('.')) {
                    const firstPath = path.split('/')[1];
                    if (firstPath && !firstPath.includes('.')) {
                        domain = `${domain}/${firstPath}`;
                    }
                }

                return domain;
            } catch {
                return url;
            }
        }

        function detectSourceType(line) {
            const trimmed = line.trim();
            if (!trimmed) return null;

            // STEP 1: Reddit
            if (/^r\/\w+$/i.test(trimmed) || /^\/r\/\w+$/i.test(trimmed)) {
                const subreddit = trimmed.replace(/^\//, '');
                return {
                    type: 'reddit',
                    value: subreddit,
                    icon: '📱',
                    displayName: subreddit,
                    description: '10 posts per day',
                };
            }

            // STEP 2: Twitter
            if (/^@\w+$/i.test(trimmed)) {
                return {
                    type: 'twitter',
                    value: trimmed,
                    icon: '🐦',
                    displayName: trimmed,
                    description: 'Latest tweets',
                };
            }

            if (/^#\w+$/i.test(trimmed)) {
                return {
                    type: 'twitter',
                    value: trimmed,
                    icon: '🐦',
                    displayName: trimmed,
                    description: 'Trending hashtag',
                };
            }

            // STEP 3: YouTube Channel IDs
            if (/^UC[\w-]{22}$/i.test(trimmed)) {
                return {
                    type: 'youtube',
                    value: trimmed,
                    icon: '🎥',
                    displayName: 'YouTube Channel',
                    description: 'Latest videos',
                };
            }

            // STEP 4: YouTube URLs
            if (/^https?:\/\/(www\.)?(youtube\.com|youtu\.be)\//i.test(trimmed)) {
                try {
                    const url = new URL(trimmed);
                    const pathMatch = url.pathname.match(/^\/(@[\w-]+)|(c\/[\w-]+)|(channel\/UC[\w-]{22})|(user\/[\w-]+)/i);

                    if (pathMatch) {
                        const identifier = (pathMatch[1] || pathMatch[2] || pathMatch[3] || pathMatch[4]).replace(/^\//, '');
                        return {
                            type: 'youtube',
                            value: trimmed,
                            icon: '🎥',
                            displayName: identifier,
                            description: 'YouTube channel',
                        };
                    }
                } catch {
                    // Invalid URL
                }
            }

            // STEP 5: EXPLICIT RSS Feeds
            if (/^https?:\/\/.+/i.test(trimmed)) {
                const hasExplicitRss = /\/(feed|rss|atom)|\.xml|\.rss/i.test(trimmed);

                if (hasExplicitRss) {
                    const cleanDomain = cleanRssUrl(trimmed);
                    return {
                        type: 'rss',
                        value: trimmed,
                        icon: '📰',
                        displayName: cleanDomain,
                        description: 'RSS feed',
                    };
                }
            }

            // STEP 6: Blog URLs
            if (/^https?:\/\/.+/i.test(trimmed)) {
                try {
                    const url = new URL(trimmed);
                    const isBlogSubdomain = /^blogs?\./.test(url.hostname);
                    const hasBlogPath = /\/(blog|news)(\/|$)/i.test(url.pathname);
                    const isBlogDomain = url.hostname.endsWith('.blog');

                    if (isBlogSubdomain || hasBlogPath || isBlogDomain) {
                        const cleanDomain = cleanRssUrl(trimmed);
                        return {
                            type: 'blog',
                            value: trimmed,
                            icon: '📝',
                            displayName: cleanDomain,
                            description: 'Blog URL',
                        };
                    }
                } catch {
                    // Invalid URL
                }
            }

            // STEP 7: Generic URL Fallback
            if (/^https?:\/\/.+/i.test(trimmed)) {
                try {
                    const url = new URL(trimmed);
                    const hasPath = url.pathname.length > 1 && url.pathname !== '/';

                    if (hasPath) {
                        const cleanDomain = cleanRssUrl(trimmed);
                        const feedUrl = trimmed.endsWith('/') ? `${trimmed}feed` : `${trimmed}/feed`;
                        return {
                            type: 'rss',
                            value: feedUrl,
                            icon: '📰',
                            displayName: cleanDomain,
                            description: '⚠️ Auto-detected as RSS (please verify)',
                        };
                    }

                    const cleanDomain = cleanRssUrl(trimmed);
                    return {
                        type: 'blog',
                        value: trimmed,
                        icon: '📝',
                        displayName: cleanDomain,
                        description: '⚠️ Detected as blog (please verify)',
                    };
                } catch {
                    return null;
                }
            }

            return null;
        }

        // Run tests
        const lines = testUrls.split('\n').filter(line => line.trim());
        const results = lines.map(line => ({
            input: line,
            detected: detectSourceType(line)
        }));

        // Calculate stats
        const stats = {
            total: results.length,
            reddit: results.filter(r => r.detected?.type === 'reddit').length,
            twitter: results.filter(r => r.detected?.type === 'twitter').length,
            youtube: results.filter(r => r.detected?.type === 'youtube').length,
            rss: results.filter(r => r.detected?.type === 'rss').length,
            blog: results.filter(r => r.detected?.type === 'blog').length,
            error: results.filter(r => !r.detected).length,
        };

        // Render stats
        document.getElementById('stats').innerHTML = `
            <div class="stat-card">
                <div class="stat-value">${stats.total}</div>
                <div class="stat-label">Total URLs</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${stats.reddit}</div>
                <div class="stat-label">📱 Reddit</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${stats.twitter}</div>
                <div class="stat-label">🐦 Twitter</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${stats.youtube}</div>
                <div class="stat-label">🎥 YouTube</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${stats.rss}</div>
                <div class="stat-label">📰 RSS</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${stats.blog}</div>
                <div class="stat-label">📝 Blog</div>
            </div>
        `;

        // Render results
        document.getElementById('results').innerHTML = results.map(r => {
            const type = r.detected?.type || 'error';
            const icon = r.detected?.icon || '❌';
            const description = r.detected?.description || 'Not detected';

            return `
                <div class="test-item ${type}">
                    <span class="icon">${icon}</span>
                    <span class="url">${r.input}</span>
                    <span class="description">${description}</span>
                    <span class="type ${type}">${type.toUpperCase()}</span>
                </div>
            `;
        }).join('');
    </script>
</body>
</html>
